<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Example 10</title>
    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="simple.mvc.js"></script>
    <script>
    $(function() {
      // Room Model
      var Room = function(number, price) {
        this.number = number;
        this.price = price;
        this.toString = function() {
          return "Room # " + this.number + " costs $" + this.price;
        }
      }
      // Simple MVC Room Manager
      var roomManager = $('#roomManager').ModelView(
      // MVC Model
      {
        foo: "bar",
        selectedRoom: null,
        // Todo: Retrieve from an external datasource (database / webservice)
        rooms: MVC.List([new Room(101, 500), new Room(102, 600)])
      },
      // Settings & Events
      {
        change: function(e, n, v, o, t, s) { // event, name, value, object, targetValue, selectedValue
          if(n === 'rooms') { // Only update selected room when rooms change!
            o.Set('selectedRoom', s);
          }
        }
      },
      // Methods
      {
        init: function(o) { // Simple MVC built-in initalize method which runs after 1 ms
          // var select = o.Find('select[name*="rooms"]').empty();
          // $.each(o.Get('rooms'), function(k, v) {
          //   select.append($('<option />').attr({'value': v.toString()}).text(v['number']));
          // });
          o.FillSelect('rooms', 'number', 'toString()');
          o.Set('selectedRoom', o.Get('rooms').Get(0));
          setTimeout(function() {
            o.Set('foo', 'hello');
          },2000);
        }
      });


      var roomManager2 = $('#roomManager2').ModelView(
      // MVC Model
      {
        foo: "bla",
        selectedRoom: null,
        // Todo: Retrieve from an external datasource (database / webservice)
        rooms: MVC.List([new Room(300, 500), new Room(500, 600)])
      },
      // Settings & Events
      {
        change: function(e, n, v, o, t, s) { // event, name, value, object, targetValue, selectedValue
          if(n === 'rooms') { // Only update selected room when rooms change!
            o.Set('selectedRoom', s);
          }
          // console.log(o.GetModelData());
        }
      },
      // Methods
      {
        init: function(o) { // Simple MVC built-in initalize method which runs after 1 ms
          o.FillSelect('rooms', 'number', 'toString()');
          o.Set('selectedRoom', o.Get('rooms').Get(0));
          setTimeout(function() {
            o.Set('foo', 'world');
          },2000);
        }
      });
    });
    </script>
  </head>
  <body>
    <!-- Plain HTML code! -->
    <div id="roomManager">
      <input name="foo" />
      <!-- Select Room -->
      <label>Choose a room:</label>
      <select name="rooms" class="excludeFromModel"></select>
    </div>
    <!-- Room information -->
    <span datasrc="#roomManager" name="selectedRoom"></span>
    <br />
    <div datasrc="#roomManager">
      <div>
        Selected room: <span name="selectedRoom"></span>
      </div>
    </div>

    <hr />


    <!-- Plain HTML code! -->
    <div id="roomManager2">
      <input name="foo" />
      <!-- Select Room -->
      <label>Choose a room:</label>
      <select name="rooms" class="excludeFromModel"></select>
    </div>
    <!-- Room information -->
    <span datasrc="#roomManager2" name="selectedRoom"></span>
    <br />
    <div datasrc="#roomManager2">
      <div>
        Selected room: <span name="selectedRoom"></span>
      </div>
    </div>
  </body>
</html>