<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Example 10</title>
    <script src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script type="text/javascript" src="simple.mvc.js"></script>
    <script>
    $(function() {
      // Room Model
      var Room = function(number, price) {
        this.number = number;
        this.price = price;
        this.toString = function() {
          return "Room # " + this.number + " costs $" + this.price;
        }
      }
      var roomManager = $('#roomManager').ModelView(
      // MVC Model
      {
        selectedRoom: null,
        // Todo: Retrieve from an external datasource (database / webservice)
        rooms: MVC.List([new Room(101, 500), new Room(102, 600)])
      },
      // Settings & Events
      {
        change: function(e, n, v, o, t, s) { // event, name, value, object, targetValue, selectedValue
          if(n === 'rooms') { // Only update selected room when rooms change!
            o.Set('selectedRoom', s);
          }
          o.updateUI();
        }
      },
      // Methods
      {
        addRoom: function(e, o) {
          var roomNumber = o.Find('[name*="roomNumber"]').val();
          var roomPrice = o.Find('[name*="roomPrice"]').val();
          // Todo: Add input validation.
          var room = new Room(roomNumber, roomPrice);
          o.getRooms().Add(room);
          o.addRoomsToList();
          o.updateUI();
        },
        removeRoom: function(e, o) {
          var room = o.Get('selectedRoom');
          o.getRooms().Remove(room);
          o.addRoomsToList();
          o.updateUI();
        },
        getRooms: function() {
          return this.Get('rooms');
        },
        addRoomsToList: function(e, o) {
          var select = this.Find('select[name*="rooms"]').empty();
          $.each(this.getRooms(), function(k, v) {
            select.append($('<option />').attr({'value': v.toString()}).text(v['number']));
          });
        },
        updateUI: function() {
          this.Set('roomCount', this.getRooms().Size()); // Update room count
        },
        init: function(o) { // Simple MVC built-in initalize method which runs after 1 ms
          o.addRoomsToList();
          o.Set('selectedRoom', o.getRooms().Get(0));
          o.updateUI();
        }
      });
    });
    </script>
  </head>
  <body>
    <!-- Plain HTML code! -->
    <div id="roomManager">
      <!-- Add Room -->
      <label>Add a room:</label>
      <input type="text" name="roomNumber" />
      <input type="text" name="roomPrice" />
      <button name="addRoom" class="isEvent">Add room</button>
      <br />
      <!-- Select Room -->
      <label>Choose a room:</label>
      <select name="rooms" class="excludeFromModel"></select>
      <!-- Remove Room -->
      <button name="removeRoom" class="isEvent">Remove room</button>
    </div>
    <!-- Room information -->
    <div datasrc="#roomManager">
      Selected room: <span name="selectedRoom"></span>
      <br />
      Rooms: <span name="roomCount"></span>
    </div>
  </body>
</html>