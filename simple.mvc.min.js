var MVC={KeyCheck:function(e,n){if(e.keyCode===13&&(n==="enter"||n==="return"))return true;else if(e.keyCode===27&&n==="escape")return true;return false},List:function(array){if(array===null||array===undefined)array=[];else if(!$.isArray(array)&&typeof array==="object"){var newArray=[],i=0;$.each(array,function(k,v){if(typeof v!=="function"){newArray[i]=v;i++}});array=newArray}array.Size=function(){return array.length};array.Add=function(element){array.push(element);return array};array.Remove=function(element){var i=
$.inArray(element,array);if(i!==-1){array.splice(i,1);console.log("removed "+element+" from array");return true}return false};return array},Controller:function(data){return data}};
(function($){$.fn.extend({ModelView:function($object,$settings,$methods){$this=$(this);var viewId="#"+$this.attr("id");if(!$object)$object={};else $object=$.extend({},true,$object);if(!$methods)$methods={};else $object=$.extend({},true,$object,$methods);if(!$settings)$settings={};var datasrc=$settings["datasrc"];var clone=$settings["clone"];if(clone!==undefined){clone["template"]=viewId;viewId=""+clone["id"];if(viewId.substring(0,1)==="#")viewIdNoHash=viewId.substring(1,viewId.length);else viewIdNoHash=
viewId;var withDataAndEvents=$settings["clone"]["withDataAndEvents"];withDataAndEvents=withDataAndEvents!==undefined?withDataAndEvents:false;$settings["clone"]["withDataAndEvents"]=withDataAndEvents;var element=$($(clone["template"]).clone(withDataAndEvents)).attr("id",viewIdNoHash);datasrc=datasrc!==undefined?datasrc:viewId;$(element).find('[datasrc=""]').attr("datasrc",datasrc);clone["append"](element)}if($settings["viewId"]===undefined)$.extend($settings,{viewId:viewId});if($settings["isMirror"]===
undefined)$.extend($settings,{isMirror:true});if($settings["eventUsed"]===undefined)$.extend($settings,{eventUsed:""});if($settings["preventDefault"]===undefined)$.extend($settings,{preventDefault:true});$(viewId+" button,"+viewId+" a,"+viewId+" submit,"+viewId+" i").each(function(i,e){$(this).click(function(e){$object.Start(e.target.name,e);if($settings["settings"]["preventDefault"])e.preventDefault()})});$object.Save=function(par){return $object.Start("Save",par)};$object.Update=function(par){return $object.Start("Update",
par)};$object.Delete=function(par){return $object.Start("Delete",par)};$object.Clear=function(prop){$object.Set(prop,"");$object[prop]="";return $object};$object.ClearAll=function(){$.each($object.GetModelData(),function(prop){$object.Clear(prop)});return $object};$object.AddGetSet=function(prop){$($object).bind("get"+prop,function(event,ret){ret["value"]=$object[prop]}).bind("set"+prop,function(event,newVal){var oldVal=$object[prop];if(oldVal!==newVal){$object[prop]=newVal;$object.SetViewFromModel();
$object.TriggerEvent(prop,"change")}});return $object};$object.RemoveGetSet=function(prop){$($object).unbind("get"+prop).unbind("set"+prop);return $object};$object.TriggerEvent=function(prop,evt){$(viewId+' :input[name="'+prop+'"]').not(".excludeFromModel").trigger(evt);return $object};$object.AddProperty=function(prop,value){$object[prop]=value;$object.AddGetSet(prop);console.log("Added property "+prop+" to the Model.");return $object};$object.RemoveProperty=function(prop){$object.RemoveGetSet(prop);
delete $object[prop];console.log("Removed property "+prop+" from the Model.");return $object};$object.Set=function(prop,value){$($object).triggerHandler("set"+prop,[value]);$object.SetDataboundDomVal(datasrc,prop,value);return $object};$object.Get=function(prop){var result={value:undefined};$($object).triggerHandler("get"+prop,[result]);return result["value"]};$object.Has=function(prop){if($object.Get(prop)!==undefined)return true;return false};$object.GetDatasrcId=function(){return $object.datasrc};
$object.GetModelData=function(withSettings){var modelObjectData={};$.each($object,function(k,v){if((typeof v).toString()!=="function")if(/jQuery\d*/.test(k))return true;else if(!withSettings&&k==="settings")return true;else modelObjectData[k]=v});return modelObjectData};$object.GetViewHtml=function(){return $this};$object.GetViewData=function(){return $(viewId).getSetHtml()};$object.SetViewData=function(){$(viewId).getSetHtml($object)};$object.SetViewFromModel=function(){$object.SetViewData();$.each($object.GetModelData(),
function(key,newVal){$object.SetDataboundDomVal(viewId,key,newVal)});return $object};$object.SetModelFromView=function(){var data=$object.GetViewData();$.each(data,function(key,newVal){var oldVal=$object[key];var valType=typeof oldVal;if(oldVal!==newVal)$object[key]=newVal;$object.SetDataboundDomVal(viewId,key,newVal)});return $object};$object.SetDataboundDomVal=function(datasrc,name,value){$("div[datasrc|="+datasrc+"][name|="+name+"],p[datasrc|="+datasrc+"][name|="+name+"],span[datasrc|="+datasrc+
"][name|="+name+"]").text(value);$("input[datasrc|="+datasrc+"][name|="+name+"]").val(value);return $object};$object.RunEvent=function(event){var type=event.type;if(type===undefined)type=event;if(event===undefined)return;if($.trim(event.target.name).length>0){if($settings["settings"][type]!==undefined&&$settings["settings"][type]!==null){$settings["settings"]["eventUsed"]=type;$settings["settings"][type](event,event.target.name,event.target.value)}}else console.log("source element has no name attribute assigned (required!)");
return $object};$object.RunCtr=function(method,par){$object.Start(method,par)};$object.Start=function(method,par){var exec=$object["settings"]["controller"][method];if(exec!==undefined&&exec!==null)exec(par);else console.log("Missing "+method+"() method!");return $object};$object.toArray=function(){return $.makeArray($object)};$object.GetViewId=function(){return $object["settings"]["viewId"]};$object.Find=function(selector){return $($object.GetViewId()+" "+selector)};$object.AddEvents=function(){$(viewId+
" :input").not(".excludeFromModel").focus(function(e){$object.RunEvent(e)}).blur(function(e){$object.RunEvent(e)}).change(function(e){$object.SetModelFromView();$object.RunEvent(e)}).select(function(e){$object.RunEvent(e)}).submit(function(e){$object.RunEvent(e)}).keyup(function(e){if($settings["settings"]["keyup"]===undefined)$object.SetModelFromView();$object.RunEvent(e)}).keypress(function(e){$object.RunEvent(e)}).keydown(function(e){$object.RunEvent(e)});return $object};$object.SetViewFromModel();
$object.SetModelFromView();if($settings["isMirror"])$.each($object,function(k,v){$object.AddGetSet(k)});if($settings["autoSaveInterval"]>0){$settings["eventUsed"]='"autoSave"';setInterval(function(){$object.Save()},$settings["autoSaveInterval"])}$object.AddEvents();$settings={settings:$settings};$.extend($object,$settings);var init=$object["init"];if(init!==undefined&&init!==null)setTimeout(function(){init()},1);return $object}})})(jQuery);
(function($){$.fn.extend({getSetHtml:function(params){if(params!==undefined)return this.setValues(params);else return this.getValues()},getInputElements:function(target){return target.find("input,select,textarea").filter(":not(.excludeFromModel)")},getElementKey:function(element){var key=$(element).attr("datafld");if(key===undefined)key=$(element).attr("id");return key},getDivElements:function(target){return target.find("p,span,div").filter(":not(.excludeFromModel)")},setValues:function(params){var $this=
this;$this.getDivElements(this).each(function(){var key=$this.getElementKey(this);if(key===undefined)return;var value=params[key];$(this).html(value)});$this.getInputElements(this).each(function(){var value=params[$(this).attr("name")],$this;if(value!==undefined){$this=$(this);if($this.is(":radio")){if($this.val()===value)$this.attr("checked",true)}else if($this.is(":checkbox")){if(value)$this.attr("checked",true);else{value=$.isArray(value)?value:[value];if($.inArray($this.val(),value)>-1)$this.attr("checked",
true)}$this.val(value)}else $this.val(value)}})},getValues:function(){var data={},formData={};var $this=this;$this.getInputElements(this).each(function(){var elm=$(this);var type=elm.attr("type"),name=elm.attr("name"),value=elm.val();if(type==="submit"||!name)return;if(elm.hasClass("isNumber"))value=parseInt(value,null);if(elm.is(":checkbox")){value=false;if(elm.attr("checked"))value=true;formData[name]=value}else if(elm.is(":radio")){if(elm.attr("checked"))formData[name]=value}else formData[name]=
value});$this.getDivElements(this).each(function(){var elem=$(this);var value=elem.text();if(value!==undefined){var key=$this.getElementKey(this);if(key===undefined)return;if(elem.hasClass("isNumber"))value=parseInt(value,null);data[key]=value}});$.extend(data,formData);return data}})})(jQuery);