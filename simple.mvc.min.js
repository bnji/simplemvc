var counter=0,CMN={LOG:function(c){console.log(c)},JSTR:function(c){return CMN.JSTR(c,null,2)}},MVC={Controller:function(c){return c},ModelView:function(c,a,b){CMN.LOG("ModelView Created...");if(null===a||void 0===a)a={};if(null===b||void 0===b)b={};void 0===b.viewId&&$.extend(b,{viewId:c});void 0===b.reflectModelChangeInView&&$.extend(b,{reflectModelChangeInView:!0});a.Save=function(b){MVC.CtrRun("Save",a,b)};a.Update=function(b){MVC.CtrRun("Update",a,b)};a.Delete=function(b){MVC.CtrRun("Delete",
a,b)};a.AddGetSet=function(b,c){CMN.LOG("AddGetSet");$(a).bind("get"+b,function(c,d){d.val=a[b]}).bind("set"+b,function(d,h){var i=a[b];i!==h&&(a[b]=h,c(b,i,h))})};a.RemoveGetSet=function(){};a.Set=function(b,c){CMN.LOG("Set()");$(a).trigger("set"+b,[c])};a.Get=function(b){CMN.LOG("Get()");var c={val:void 0};$(a).triggerHandler("get"+b,[c]);return c.val};a.SetDomVal=function(){CMN.LOG("SetDomVal()");$(c).getSetHtml(a)};a.GetDomVal=function(){CMN.LOG("GetDomVal()");return $(c).getSetHtml()};a.SetModelFromView=
function(b){CMN.LOG("SetModelFromView()");var d=a.GetDomVal();$.each(d,function(d,e){a[d]!==e&&(a[d]=e,(void 0===b||!0===b)&&a.SetDataboundDomVal(c,d,e))});return d};a.SetDataboundDomVal=function(b,a,c){CMN.LOG("SetDataboundDomVal()");CMN.LOG(counter+" - datasrc: "+b+" - name: "+a+" - value: "+c);$("div[datasrc|="+b+"][name|="+a+"],p[datasrc|="+b+"][name|="+a+"],span[datasrc|="+b+"][name|="+a+"]").text(c);$("input[datasrc|="+b+"][name|="+a+"]").val(c);counter++};a.SetDomVal();a.SetModelFromView();
b.reflectModelChangeInView&&$.each(a,function(b){a.AddGetSet(b,function(b){a.SetDomVal();$(":input[name="+b+"]").not(".excludeFromModel").trigger("change")})});var d=b.autoSaveInterval;0<d&&setInterval(function(){a.Save()},d);$(c+" :input").not(".excludeFromModel").focus(function(a){MVC.EvtRun(b,a)}).blur(function(a){MVC.EvtRun(b,a)}).change(function(c){a.SetModelFromView();MVC.EvtRun(b,c)}).select(function(a){MVC.EvtRun(b,a)}).submit(function(a){MVC.EvtRun(b,a)}).keyup(function(c){void 0===b.settings.keyup&&
a.SetModelFromView();MVC.EvtRun(b,c)}).keypress(function(a){MVC.EvtRun(b,a)}).keydown(function(a){MVC.EvtRun(b,a)});b={settings:b};$.extend(a,b);return a},EvtRun:function(c,a){var b=a.type;void 0===b&&(b=a);if(void 0===a)CMN.LOG('event "e" is undefined!');else if(0<$.trim(a.target.name).length){if(void 0!==c.settings[b]&&null!==c.settings[b])c.settings[b](a,a.target.name,a.target.value)}else CMN.LOG("source element has no name attribute assigned (required!)")},CtrRun:function(c,a,b){var d=a.settings.controller[c];
void 0!==d&&null!==d?d(a,b):alert("Missing "+c+"() method!")}};
(function(c){c.fn.extend({getSetHtml:function(a){return void 0!==a?this.setValues(a):this.getValues()},getInputElements:function(a){return a.find("input,select,textarea").filter(":not(.excludeFromModel)")},getElementKey:function(a){var b=c(a).attr("datafld");void 0===b&&(b=c(a).attr("id"));return b},getDivElements:function(a){return a.find("p,span,div").filter(":not(.excludeFromModel)")},setValues:function(a){CMN.LOG("setValues called!");$this=this;$this.getDivElements(this).each(function(){var b=
$this.getElementKey(this);void 0!==b&&(b=a[b],CMN.LOG(b),c(this).text(b))});$this.getInputElements(this).each(function(){var b=a[c(this).attr("name")],d;void 0!==b&&(d=c(this),d.is(":radio")?d.val()===b&&d.attr("checked",!0):(d.is(":checkbox")&&(b=c.isArray(b)?b:[b],-1<c.inArray(d.val(),b)&&d.attr("checked",!0)),d.val(b)))})},getValues:function(){var a={},b={};$this=this;$this.getInputElements(this).each(function(){var a=c(this),g=a.attr("type"),e=a.attr("name"),f=a.val();"submit"!==g&&e&&(a.hasClass("isNumber")&&
(f=parseInt(f)),a.is(":checkbox")?(f=!1,a.attr("checked")&&(f=!0),b[e]=f):a.is(":radio")?a.attr("checked")&&(b[e]=f):b[e]=f)});$this.getDivElements(this).each(function(){var b=c(this),g=b.text();if(void 0!==g){var e=$this.getElementKey(this);void 0!==e&&(b.hasClass("isNumber")&&(g=parseInt(g)),a[e]=g)}});return a=c.extend(a,b)}})})(jQuery);