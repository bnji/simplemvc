var MVC={KeyCheck:function(d,a){return 13===d.keyCode&&("enter"===a||"return"===a)||27===d.keyCode&&"escape"===a?!0:!1},List:function(d){if(null===d||void 0===d)d=[],console.log("new array");else if(!$.isArray(d)&&"object"===typeof d){var a=[],c=0;$.each(d,function(d,f){"function"!==typeof f&&(a[c]=f,c++)});d=a}d.Size=function(){return d.length};d.Add=function(a){d.push(a);return d};d.Remove=function(a){var c=$.inArray(a,d);return-1!==c?(d.splice(c,1),console.log("removed "+a+" from array"),!0):!1};
return d},Controller:function(d){return d},ModelView:function(d,a,c,e){a=a?$.extend({},!0,a):{};e?a=$.extend({},!0,a,e):e={};c||(c={});var f=c.datasrc,e=c.clone;if(void 0!==e){e.template=d;d=""+e.id;viewIdNoHash="#"===d.substring(0,1)?d.substring(1,d.length):d;var g=c.clone.withDataAndEvents,g=void 0!==g?g:!1;c.clone.withDataAndEvents=g;g=$($(e.template).clone(g)).attr("id",viewIdNoHash);f=void 0!==f?f:d;$(g).find('[datasrc=""]').attr("datasrc",f);e.append(g)}void 0===c.viewId&&$.extend(c,{viewId:d});
void 0===c.isMirror&&$.extend(c,{isMirror:!0});void 0===c.eventUsed&&$.extend(c,{eventUsed:""});void 0===c.preventDefault&&$.extend(c,{preventDefault:!0});$(d+" button,"+d+" a,"+d+" submit,"+d+" i").each(function(){$(this).click(function(b){a.RunCtr(b.target.name,b);c.settings.preventDefault&&b.preventDefault()})});a.Save=function(b){return a.RunCtr("Save",b)};a.Update=function(b){return a.RunCtr("Update",b)};a.Delete=function(b){return a.RunCtr("Delete",b)};a.Clear=function(b){a[b]="";a.Set(b,"");
return a};a.ClearAll=function(){$.each(a.GetModelData(),function(b){a.Clear(b)});return a};a.AddGetSet=function(b){$(a).bind("get"+b,function(d,c){c.value=a[b]}).bind("set"+b,function(d,c){a[b]!==c&&(a[b]=c,a.SetViewFromModel(),a.TriggerEvent(b,"change"))});return a};a.RemoveGetSet=function(b){$(a).unbind("get"+b).unbind("set"+b);return a};a.TriggerEvent=function(b,c){$(d+' :input[name="'+b+'"]').not(".excludeFromModel").trigger(c);return a};a.AddProperty=function(b,d){a[b]=d;a.AddGetSet(b);console.log("Added property "+
b+" to the Model.");return a};a.RemoveProperty=function(b){a.RemoveGetSet(b);delete a[b];console.log("Removed property "+b+" from the Model.");return a};a.Set=function(b,d){$(a).triggerHandler("set"+b,[d]);a.SetDataboundDomVal(f,b,d);return a};a.Get=function(b){var d={value:void 0};$(a).triggerHandler("get"+b,[d]);return d.value};a.Has=function(b){return void 0!==a.Get(b)?!0:!1};a.GetDatasrcId=function(){return a.datasrc};a.GetModelData=function(b){var d={};$.each(a,function(a,c){if("function"!==
(typeof c).toString()){if(/jQuery\d*/.test(a)||!b&&"settings"===a)return!0;d[a]=c}});return d};a.GetViewData=function(){return $(d).getSetHtml()};a.SetViewData=function(){$(d).getSetHtml(a)};a.SetViewFromModel=function(){a.SetViewData();$.each(a.GetModelData(),function(b,c){a.SetDataboundDomVal(d,b,c)});return a};a.SetModelFromView=function(){var b=a.GetViewData();$.each(b,function(b,c){a[b]!==c&&(a[b]=c);a.SetDataboundDomVal(d,b,c)});return a};a.SetDataboundDomVal=function(b,d,c){$("div[datasrc|="+
b+"][name|="+d+"],p[datasrc|="+b+"][name|="+d+"],span[datasrc|="+b+"][name|="+d+"]").text(c);$("input[datasrc|="+b+"][name|="+d+"]").val(c);return a};a.RunEvent=function(b){var d=b.type;void 0===d&&(d=b);if(void 0!==b)return 0<$.trim(b.target.name).length?void 0!==c.settings[d]&&null!==c.settings[d]&&(c.settings.eventUsed=d,c.settings[d](b,b.target.name,b.target.value)):console.log("source element has no name attribute assigned (required!)"),a};a.RunCtr=function(b,d){var c=a.settings.controller[b];
void 0!==c&&null!==c?c(d):console.log("Missing "+b+"() method!");return a};a.toArray=function(){return $.makeArray(a)};a.GetViewId=function(){return a.settings.viewId};a.Find=function(b){return $(a.GetViewId()+" "+b)};a.AddEvents=function(){$(d+" :input").not(".excludeFromModel").focus(function(b){a.RunEvent(b)}).blur(function(b){a.RunEvent(b)}).change(function(b){a.SetModelFromView();a.RunEvent(b)}).select(function(b){a.RunEvent(b)}).submit(function(b){a.RunEvent(b)}).keyup(function(b){void 0===
c.settings.keyup&&a.SetModelFromView();a.RunEvent(b)}).keypress(function(b){a.RunEvent(b)}).keydown(function(b){a.RunEvent(b)});return a};a.SetViewFromModel();a.SetModelFromView();c.isMirror&&$.each(a,function(b){a.AddGetSet(b)});0<c.autoSaveInterval&&(c.eventUsed='"autoSave"',setInterval(function(){a.Save()},c.autoSaveInterval));a.AddEvents();c={settings:c};$.extend(a,c);var h=a.init;void 0!==h&&null!==h&&setTimeout(function(){h()},1);return a}};
(function(d){d.fn.extend({getSetHtml:function(a){return void 0!==a?this.setValues(a):this.getValues()},getInputElements:function(a){return a.find("input,select,textarea").filter(":not(.excludeFromModel)")},getElementKey:function(a){var c=d(a).attr("datafld");void 0===c&&(c=d(a).attr("id"));return c},getDivElements:function(a){return a.find("p,span,div").filter(":not(.excludeFromModel)")},setValues:function(a){var c=this;c.getDivElements(this).each(function(){var e=c.getElementKey(this);void 0!==e&&
(e=a[e],d(this).html(e))});c.getInputElements(this).each(function(){var c=a[d(this).attr("name")],f;void 0!==c&&(f=d(this),f.is(":radio")?f.val()===c&&f.attr("checked",!0):(f.is(":checkbox")&&(c?f.attr("checked",!0):(c=d.isArray(c)?c:[c],-1<d.inArray(f.val(),c)&&f.attr("checked",!0))),f.val(c)))})},getValues:function(){var a={},c={},e=this;e.getInputElements(this).each(function(){var a=d(this),e=a.attr("type"),h=a.attr("name"),b=a.val();"submit"!==e&&h&&(a.hasClass("isNumber")&&(b=parseInt(b,null)),
a.is(":checkbox")?(b=!1,a.attr("checked")&&(b=!0),c[h]=b):a.is(":radio")?a.attr("checked")&&(c[h]=b):c[h]=b)});e.getDivElements(this).each(function(){var c=d(this),g=c.text();if(void 0!==g){var h=e.getElementKey(this);void 0!==h&&(c.hasClass("isNumber")&&(g=parseInt(g,null)),a[h]=g)}});d.extend(a,c);return a}})})(jQuery);