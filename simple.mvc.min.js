var counter=0,Common={},MVC={Debug:function(c){return JSON.stringify(c,null,2)},Controller:function(c){return c},ModelView:function(c,a,b){console.log("ModelView Created...");if(null===a||void 0===a)a={};if(null===b||void 0===b)b={};void 0===b.viewId&&$.extend(b,{viewId:c});void 0===b.reflectModelChangeInView&&$.extend(b,{reflectModelChangeInView:!0});MVC.SetDomVal(c,a);MVC.SetModelFromDomValues(c,a);b.reflectModelChangeInView&&$.each(a,function(b){MVC.AddGetSet(a,b,function(b){MVC.SetDomVal(c,a);
$(":input[name="+b+"]").not(".excludeFromModel").trigger("change")})});var e=b.autoSaveInterval;0<e&&setInterval(function(){MVC.Save(a)},e);$(c+" :input").not(".excludeFromModel").focus(function(a){MVC.EvtRun(b,a)}).blur(function(a){MVC.EvtRun(b,a)}).change(function(e){MVC.SetModelFromDomValues(c,a);MVC.EvtRun(b,e)}).select(function(a){MVC.EvtRun(b,a)}).submit(function(a){MVC.EvtRun(b,a)}).keyup(function(e){void 0===b.settings.keyup&&MVC.SetModelFromDomValues(c,a);MVC.EvtRun(b,e)}).keypress(function(a){MVC.EvtRun(b,
a)}).keydown(function(a){MVC.EvtRun(b,a)});b={settings:b};$.extend(a,b);return a},EvtRun:function(c,a){var b=a.type;void 0===b&&(b=a);if(void 0===a)console.log('event "e" is undefined!');else if(0<$.trim(a.target.name).length){if(void 0!==c.settings[b]&&null!==c.settings[b])c.settings[b](a,a.target.name,a.target.value)}else console.log("source element has no name attribute assigned (required!)")},CtrRun:function(c,a,b){var e=a.settings.controller[c];void 0!==e&&null!==e?e(a,b):alert("Missing "+c+
"() method!")},Save:function(c,a){MVC.CtrRun("Save",c,a)},Update:function(c,a){MVC.CtrRun("Update",c,a)},Delete:function(c,a){MVC.CtrRun("Delete",c,a)},Set:function(c,a,b){console.log("Set()");$(c).trigger("set"+a,[b])},Get:function(c,a){console.log("Get()");var b={val:void 0};$(c).triggerHandler("get"+a,[b]);return b.val},AddGetSet:function(c,a,b){console.log("AddGetSet");$(c).bind("get"+a,function(b,d){d.val=c[a]}).bind("set"+a,function(e,d){var g=c[a];g!==d&&(c[a]=d,b(a,g,d))})},SetDomVal:function(c,
a){console.log("SetDomVal()");$(c).getSetHtml(a)},GetDomVal:function(c){console.log("GetDomVal()");return $(c).getSetHtml()},SetModelFromDomValues:function(c,a){console.log("SetModelFromDomValues()");var b=MVC.GetDomVal(c);$.each(b,function(b,d){var g=a[b],f=typeof g;g!==d&&("string"===f||"number"===f||"boolean"===f?(a[b]=d,MVC.SetDataboundDomVal(c,b,d)):"object"===f?(a[b]=d,MVC.SetDataboundDomVal(c,b,d)):"undefined"===f?(a[b]=d,MVC.SetDataboundDomVal(c,b,d)):alert("Missing implementation of primitive types in SetModelFromDomValues() method for type: "+
f))});return b},SetDataboundDomVal:function(c,a,b){console.log("SetDataboundDomVal()");console.log(counter+" - datasrc: "+c+" - name: "+a+" - value: "+b);$("div[datasrc|="+c+"][name|="+a+"],p[datasrc|="+c+"][name|="+a+"],span[datasrc|="+c+"][name|="+a+"]").text(b);$("input[datasrc|="+c+"][name|="+a+"]").val(b);counter++}};
(function(c){c.fn.extend({getSetHtml:function(a){return void 0!==a?this.setValues(a):this.getValues()},getInputElements:function(a){return a.find("input,select,textarea").filter(":not(.excludeFromModel)")},getElementKey:function(a){var b=c(a).attr("datafld");void 0===b&&(b=c(a).attr("id"));return b},getDivElements:function(a){return a.find("p,span,div").filter(":not(.excludeFromModel)")},setValues:function(a){console.log("setValues called!");$this=this;$this.getDivElements(this).each(function(){var b=
$this.getElementKey(this);void 0!==b&&(b=a[b],console.log(b),c(this).text(b))});$this.getInputElements(this).each(function(){var b=a[c(this).attr("name")],e;void 0!==b&&(e=c(this),e.is(":radio")?e.val()===b&&e.attr("checked",!0):(e.is(":checkbox")&&(b=c.isArray(b)?b:[b],-1<c.inArray(e.val(),b)&&e.attr("checked",!0)),e.val(b)))})},getValues:function(){var a={},b={};$this=this;$this.getInputElements(this).each(function(){var a=c(this),d=a.attr("type"),g=a.attr("name"),f=a.val();"submit"!==d&&g&&(a.hasClass("isNumber")&&
(f=parseInt(f)),a.is(":checkbox")?(f=!1,a.attr("checked")&&(f=!0),b[g]=f):a.is(":radio")?a.attr("checked")&&(b[g]=f):b[g]=f)});$this.getDivElements(this).each(function(){var b=c(this),d=b.text();if(void 0!==d){var g=$this.getElementKey(this);void 0!==g&&(b.hasClass("isNumber")&&(d=parseInt(d)),a[g]=d)}});return a=c.extend(a,b)}})})(jQuery);