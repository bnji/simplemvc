var MVC={KeyCheck:function(t,e){return(13!==t.keyCode||"enter"!==e&&"return"!==e)&&(27!==t.keyCode||"escape"!==e&&"esc"!==e)?!1:!0},List:function(t){if(null===t||void 0===t)t=[];else if(!$.isArray(t)&&"object"==typeof t){var e=[],n=0;$.each(t,function(t,r){"function"!=typeof r&&(e[n]=r,n++)}),t=e}return t.Size=function(){return t.length},t.Add=function(e){return t.push(e),t},t.Get=function(e){return t[e]},t.Find=function(e,n){var r=null;return $.each(t,function(t,i){return i[e]===n?(r=i,!1):void 0}),r},t.Remove=function(e){var n=$.inArray(e,t);return-1!==n?(t.splice(n,1),!0):!1},t.RemoveAt=function(t){return this.Remove(this.Get(t))},t.Contains=function(e){return-1!==$.inArray(e,t)},t.Clear=function(){t=[]},t},Controller:function(t){return t}};!function(t){t.fn.extend({ModelView:function(e,n,r){var i=[];$this=t(this);var a="#"+$this.attr("id");e=e?t.extend({},!0,e):{},r?e=t.extend({},!0,e,r):r={},n||(n={});var o=n.datasrc,u=n.clone;if(void 0!==u){u.template=a,a=void 0===u.id?"#"+t.now():""+u.id,viewIdNoHash="#"===a.substring(0,1)?a.substring(1,a.length):a;var c=n.clone.withDataAndEvents;c=void 0!==c?c:!1,n.clone.withDataAndEvents=c;var d=t(t(u.template).clone(c)).attr("id",viewIdNoHash);o=void 0!==o?o:a,t(d).find('[datasrc=""]').attr("datasrc",o),u.append(d)}void 0===n.viewId&&t.extend(n,{viewId:a}),void 0===n.isMirror&&t.extend(n,{isMirror:!0}),void 0===n.eventUsed&&t.extend(n,{eventUsed:""}),void 0===n.preventDefault&&t.extend(n,{preventDefault:!0}),t(a).find("*").each(function(){t(this).hasClass("isEvent")&&t(this).click(function(r){var i=t(r.target).attr("name");e.Start(i,r),n.settings.preventDefault&&r.preventDefault()})}),e.Save=function(t){return e.Start("Save",t)},e.Update=function(t){return e.Start("Update",t)},e.Delete=function(t){return e.Start("Delete",t)},e.Clear=function(t){return e.Set(t,""),e[t]="",e},e.ClearAll=function(){return t.each(e.GetModelData(),function(t){e.Clear(t)}),e},e.SizeOf=function(t){if(e.Has(t)){var n=e.Get(t);if(n){if("object"!=typeof n)return n.length;try{return n.Size()}catch(r){return n.length}}}return-1},e.ElementExists=function(e){return t(e).length>0},e.DisableWhen=function(n,r){var i=e.GetViewId(),a=e.ElementExists(n)?n:'*[name="'+n+'"]';return t('*[datasrc="'+i+'"]'+a).prop("disabled",r),t('*[datasrc="'+i+'"]').find(a).prop("disabled",r),e.Find(a).prop("disabled",r),e},e.AddGetSet=function(n){return t(e).bind("get"+n,function(t,r){r.value=e[n]}).bind("set"+n,function(t,r){var i=e[n];i!==r&&(e[n]=r,e.SetViewFromModel(),e.TriggerEvent(n,"change"))}),e},e.RemoveGetSet=function(n){return t(e).unbind("get"+n).unbind("set"+n),e},e.TriggerEvent=function(n,r){return t(a+' :input[name="'+n+'"]').not(".excludeFromModel").trigger(r),e},e.AddProperty=function(t,n){return e[t]=n,e.AddGetSet(t),e},e.RemoveProperty=function(t){return e.RemoveGetSet(t),delete e[t],e},e.Remove=function(t,n){var r=e.Get(n),i=e.Get(t);return i.Remove(r),e.FillSelect(t)},e.Add=function(t,n){var r=e.Get(t),i=e.Get(n);return r.Add(i?i:n),e.FillSelect(t)},e.Set=function(n,r){return"function"==typeof r&&(i.push({name:n,func:r}),r=r(e)),e.settings.isMirror&&!e.Has(n)&&e.AddProperty(n,r),t(e).triggerHandler("set"+n,[r]),e._SetDataboundDomVal(o?o:a,n,r),e},e.Get=function(n){var r={value:void 0};return t(e).triggerHandler("get"+n,[r]),r.value},e.Has=function(t){return void 0!==e.Get(t)?!0:!1},e.GetDatasrcId=function(){return e.datasrc},e.GetModelData=function(n){var r={};return t.each(e,function(t,e){if("function"!==(typeof e).toString()){if(/jQuery\d*/.test(t))return!0;if(!n&&"settings"===t)return!0;r[t]=e}}),r},e.GetViewHtml=function(){return $this},e.GetViewData=function(){return t(a).getSetHtml()},e.SetViewData=function(){t(a).getSetHtml(e)},e.SetViewFromModel=function(){e.SetViewData();var n=e.GetModelData();return t.each(n,function(t,n){e._SetDataboundDomVal(a,t,n)}),e},e.SetModelFromView=function(){var n=e.GetViewData();return t.each(n,function(t,n){var r=e[t];r!==n&&void 0!==n&&null!==n&&(e[t]=n),e._SetDataboundDomVal(a,t,n)}),t.each(i,function(t,n){e.Set(n.name,n.func(e))}),e},e._SetDataboundDomVal=function(n,r,i){if(i){var a=navigator.appVersion;-1!==a.indexOf("MSIE 7.")||-1!==a.indexOf("MSIE 8.")?(t('div[datasrc="'+n+'"][name="'+r+'"],p[datasrc="'+n+'"][name="'+r+'"],span[datasrc="'+n+'"][name="'+r+'"]').text(i),t('div[datasrc="'+n+'"],p[datasrc="'+n+'"],span[datasrc="'+n+'"]').find('div[name="'+r+'"],p[name="'+r+'"],span[name="'+r+'"]').text(i),t('div[datasrc="'+n+'"],p[datasrc="'+n+'"],span[datasrc="'+n+'"]').find('input[name="'+r+'"]').val(i)):(t('*[datasrc="'+n+'"][name="'+r+'"]').text(i),t('*[datasrc="'+n+'"]').find('*[name="'+r+'"]').text(i),t('*[datasrc="'+n+'"]').find('*[name="'+r+'"]').val(i)),t('input[datasrc="'+n+'"][name="'+r+'"]').val(i);var o=t('select[datasrc="'+n+'"][name="'+r+'"]');e._FillSelect(o,r,i),o=t('*[datasrc="'+n+'"]').find('select[name="'+r+'"]'),e._FillSelect(o,r,i)}return e},e._FillSelect=function(n,r,i){var a=e.Get(r);return"object"==typeof a&&n.size()>0&&(n.empty(),t.each(i,function(e,r){n.append(t("<option />").attr({value:r}).text(r))})),e},e.FillSelect=function(n,r,i){var a=r?"()"===r.substring(r.length-2,r.length):!1,o=i?"()"===i.substring(i.length-2,i.length):!1,u=e.Get(n);return t.each(e.Find('select[name*="'+n+'"]'),function(e,n){n=t(n),n.empty(),t.each(u,function(e,u){var c=r?a?u[r.substring(0,r.length-2)]():u[r]:u,d=i?o?u[i.substring(0,i.length-2)]():u[i]:u;n.append(t("<option />").attr({value:d}).text(c))})}),e},e.RunEvent=function(r){var i=r.target.name,a=r.target.value,o=r.type;if(void 0===o&&(o=r),void 0!==r){if(t.trim(i).length>0&&void 0!==n.settings[o]&&null!==n.settings[o]){n.settings.eventUsed=o;var u=e[i],c=u;if(-1!==r.target.type.indexOf("select")){var d=r.target.selectedIndex,s=r.target.options[d];s&&(a=s.value,c=u[d])}n.settings[o](r,i,a,e,u,c)}return e}},e.Start=function(t,n){var r;return void 0!==e.settings.controller&&(r=e.settings.controller[t]),void 0===r&&(r=e[t]),void 0!==r&&null!==r?r(n,e):console.log("Missing "+t+"() method!"),e},e.toArray=function(){return t.makeArray(e)},e.GetViewId=function(){return e.settings.viewId},e.Find=function(n){return t(e.GetViewId()+" "+n)},e.AddEvents=function(){return t(a+" :input").focus(function(t){e.RunEvent(t)}).blur(function(t){e.RunEvent(t)}).change(function(t){e.SetModelFromView(),e.RunEvent(t)}).select(function(t){e.RunEvent(t)}).submit(function(t){e.RunEvent(t)}).click(function(t){e.SetModelFromView(),e.RunEvent(t)}).keyup(function(t){void 0===n.settings.keyup&&e.SetModelFromView(),e.RunEvent(t)}).keypress(function(t){e.RunEvent(t)}).keydown(function(t){e.RunEvent(t)}),e},e.SetViewFromModel(),e.SetModelFromView(),n.isMirror&&t.each(e.GetModelData(),function(t){e.AddGetSet(t)}),n.autoSaveInterval>0&&(n.eventUsed='"autoSave"',setInterval(function(){e.Save()},n.autoSaveInterval)),e.AddEvents(),n={settings:n},t.extend(e,n);var s=e.init;return void 0!==s&&null!==s&&s(e),e}})}(jQuery),function(t){t.fn.extend({getSetHtml:function(t){return void 0!==t?this.setValues(t):this.getValues()},getInputElements:function(t){return t.find("input,select,textarea").not(".excludeFromModel")},getElementKey:function(e){var n=t(e).attr("datafld");return void 0===n&&(n=t(e).attr("id")),void 0===n&&(n=t(e).attr("data-bind")),n},getBindableElements:function(t){return t.find("*[data-bind], *[datafld]").filter(":not(.excludeFromModel)")},setValues:function(e){var n=this;n.getBindableElements(this).each(function(){var r=n.getElementKey(this);if(void 0!==r){var i=e[r];t(this).html(i)}}),n.getInputElements(this).each(function(){var n,r=e[t(this).attr("name")];if(void 0!==r)if(n=t(this),n.is("select")){if(!n.val()){var i=n;i.empty(),t.each(r,function(e,n){var r=n,a=n;"object"==typeof n&&t.each(n,function(t,e){var i="function"==typeof e;r=i?n.toString():t,a=i?n.toString():e}),i.append(t("<option />").attr({value:a}).text(r))})}}else n.is(":radio")?n.val()===r&&n.attr("checked",!0):n.is(":checkbox")?(r?n.attr("checked",!0):(r=t.isArray(r)?r:[r],t.inArray(n.val(),r)>-1&&n.attr("checked",!0)),n.val(r)):n.val(r)})},getValues:function(){var e={},n={},r=this;return r.getInputElements(this).each(function(){var e=t(this),r=e.attr("type"),i=e.attr("name"),a=e.val();if("submit"!==r&&i)if(e.hasClass("isNumber")&&(a=parseInt(a,null)),e.is("select")){var o=MVC.List([]);t.each(e.find("option"),function(e,n){o.Add(t(n).val())}),a=o,n[i]=a}else e.is(":checkbox")?(a=!1,e.attr("checked")|e.prop("checked")&&(a=!0),n[i]=a):e.is(":radio")?e.attr("checked")|e.prop("checked")&&(n[i]=a):n[i]=a}),r.getBindableElements(this).each(function(){var n=t(this),i=n.text();if(void 0!==i){var a=r.getElementKey(this);if(void 0===a)return;n.hasClass("isNumber")&&(i=parseInt(i,null)),e[a]=i}}),t.extend(e,n),e}})}(jQuery),String.prototype.format=String.prototype.f=function(){for(var t=this,e=arguments.length;e--;)t=t.replace(new RegExp("\\{"+e+"\\}","gm"),arguments[e]);return t};