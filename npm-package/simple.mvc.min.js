var MVC={KeyCheck:function(t,e){return(13!==t.keyCode||"enter"!==e&&"return"!==e)&&(27!==t.keyCode||"escape"!==e&&"esc"!==e)?!1:!0},List:function(t){if(null===t||void 0===t)t=[];else if(!$.isArray(t)&&"object"==typeof t){var e=[],n=0;$.each(t,function(t,r){"function"!=typeof r&&(e[n]=r,n++)}),t=e}return t.Size=function(){return t.length},t.Add=function(e){return t.push(e),t},t.Get=function(e){return t[e]},t.Sort=function(){return t.sort(function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}),t},t.Reverse=function(){return t.Sort().reverse()},t.Find=function(e,n){var r=null;return $.each(t,function(t,i){return i[e]===n?(r=i,!1):void 0}),r},t.Remove=function(e){var n=$.inArray(e,t);return-1!==n?(t.splice(n,1),!0):!1},t.RemoveAt=function(t){return this.Remove(this.Get(t))},t.Contains=function(e){return-1!==$.inArray(e,t)},t.Clear=function(){t=[]},t},Controller:function(t){return t},Extensions:[]};!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(t.jQuery)}(this,function(t){t.fn.extend({ModelView:function(e,n,r){var o=[];$this=t(this);var a="#"+$this.attr("id");e=e?e:{};var s=e.model?e.model:e;e=t.extend({},!0,e,s),r=r?r:{},r=e.methods?e.methods:r,e=t.extend({},!0,e,r),n=n?n:{},n=e.settings?e.settings:n;var u=n.controller?n.controller:{};u=e.controller?e.controller:u,n=t.extend({},!0,n,{controller:u}),e=t.extend({},!0,e,{settings:n}),e.ElementExists=function(e){return t(e).length>0};var c=e.settings.datasrc,d=e.settings.clone;if("string"==typeof d){var l=t(d);e.ElementExists(l)&&(d={append:function(e){l.html(e),t(e).show().html()}})}if(void 0!==d){d.template=a,a=void 0===d.id?"#"+t.now():""+d.id,viewIdNoHash="#"===a.substring(0,1)?a.substring(1,a.length):a;var f=e.settings.clone.withDataAndEvents;f=void 0!==f?f:!1,e.settings.clone.withDataAndEvents=f;var v=t(t(d.template).clone(f)).attr("id",viewIdNoHash);c=void 0!==c?c:a,t(v).find('[datasrc=""]').attr("datasrc",c),d.append(v)}void 0===e.settings.viewId&&t.extend(n,{viewId:a}),void 0===e.settings.isMirror&&t.extend(n,{isMirror:!0}),void 0===e.settings.eventUsed&&t.extend(n,{eventUsed:""}),void 0===e.settings.preventDefault&&t.extend(n,{preventDefault:!0}),void 0===e.settings.change&&(e.settings.change=function(){}),void 0===e.settings.keyup&&(e.settings.keyup=function(){}),t(a).find("*").each(function(){t(this).hasClass("isEvent")&&t(this).click(function(n){var r=t(n.target).attr("name");e.Start(r,n),e.settings.preventDefault&&n.preventDefault()})}),e.Save=function(t){return e.Start("Save",t)},e.Update=function(t){return e.Start("Update",t)},e.Delete=function(t){return e.Start("Delete",t)},e.Reset=function(){return t.each(e.settings.originalModelValues,function(t,n){e.Set(t,n)}),e},e.Clear=function(n){return n?e._ClearProp(n):t.each(e.GetModelData(),function(t){e._ClearProp(t)}),e},e._ClearProp=function(t){e.Set(t,""),e[t]=""},e.SizeOf=function(t){if(e.Has(t)){var n=e.Get(t);if(n){if("object"!=typeof n)return n.length;try{return n.Size()}catch(r){return n.length}}}return-1},e.DisableWhen=function(n,r){var i=e.GetViewId(),o=e.ElementExists(n)?n:'*[name="'+n+'"]';return t('*[datasrc="'+i+'"]'+o).prop("disabled",r),t('*[datasrc="'+i+'"]').find(o).prop("disabled",r),e.Find(o).prop("disabled",r),r},e.sortMethod=null,e.SortASC=function(t){return e.Has(t)&&(e.sortMethod="ASC"),e},e.SortDESC=function(t){return e.Has(t)&&(e.sortMethod="DESC"),e},e.AddGetSet=function(n){return t(e).bind("get"+n,function(t,r){r.value=e[n]}).bind("set"+n,function(t,r){var i=e[n];i!==r&&(e[n]=r,e.SetViewFromModel(),e.TriggerEvent(n,"change"))}),e},e.RemoveGetSet=function(n){return t(e).unbind("get"+n).unbind("set"+n),e},e.TriggerEvent=function(n,r){return t(a+' :input[name="'+n+'"]').not(".excludeFromModel").trigger(r),e},e.AddProperty=function(t,n){return e[t]=n,e.AddGetSet(t),e},e.RemoveProperty=function(t){return e.RemoveGetSet(t),delete e[t],e},e.Remove=function(t,n){var r=e.Get(n),i=e.Get(t);return i.Remove(r),e.FillSelect(t)},e.Add=function(t,n){var r=e.Get(t),i=e.Get(n),o=i?i:n;return r&&o?(r.Add(o),e.FillSelect(t)):e},e.Set=function(n,r){return"function"==typeof r&&(o.push({name:n,func:r}),r=r(e)),e.settings.isMirror&&!e.Has(n)&&e.AddProperty(n,r),e.Get(n)&&typeof e.Get(n)!=typeof r||t(e).triggerHandler("set"+n,[r]),e._SetDataboundDomVal(c?c:a,n,r),e},e.Get=function(n){var r={value:void 0};return t(e).triggerHandler("get"+n,[r]),r.value},e.New=function(n){var r=n;n=(""+n).length>0&&"#"===n.substring(0,1)?n:"#"+n;var i=t(n).getSetHtml(),o=e._getFunctionFromString(r);return"function"==typeof o?new o(i):null},e._getFunctionFromString=function(t){var e=MVC.Extensions?MVC.Extensions:window,n=(""+t).split(".");for(i=0;i<n.length-1;i++)if(e=e[n[i]],void 0==e)return;return e[n[n.length-1]]},e.Has=function(t){return void 0!==e.Get(t)?!0:!1},e.GetDatasrcId=function(){return e.datasrc},e.GetModelData=function(n){var r={};return t.each(e,function(t,e){if("function"!=typeof e&&"model"!==t&&"controller"!==t&&"methods"!==t&&"sortMethod"!==t){if(/jQuery\d*/.test(t))return!0;if(!n&&"settings"===t)return!0;r[t]=e}}),r},e.GetViewHtml=function(){return $this},e.GetViewData=function(){return t(a).getSetHtml()},e.SetViewData=function(){t(a).getSetHtml(e)},e.SetViewFromModel=function(){e.SetViewData();var n=e.GetModelData();return t.each(n,function(t,n){e._SetDataboundDomVal(a,t,n)}),e},e.SetModelFromView=function(){var n=e.GetViewData();return t.each(n,function(t,n){var r=e[t];r!==n&&void 0!==n&&null!==n&&(e[t]=n),e._SetDataboundDomVal(a,t,n)}),t.each(o,function(t,n){e.Set(n.name,n.func(e))}),e},e._SetDataboundDomVal=function(n,r,i){if(i){t('*[datasrc="'+n+'"][name="'+r+'"]').text(i),t('*[datasrc="'+n+'"]').find('*[name="'+r+'"]').text(i),t('*[datasrc="'+n+'"]').find('*[name="'+r+'"]').val(i),t('input[datasrc="'+n+'"][name="'+r+'"]').val(i);var o=t('select[datasrc="'+n+'"][name="'+r+'"]');e._FillSelect(o,r,i),o=t('*[datasrc="'+n+'"]').find('select[name="'+r+'"]'),e._FillSelect(o,r,i)}return e},e.Comparator=function(t,e){return e>t?-1:t>e?1:0},e._FillSelect=function(n,r,i){var o=e.Get(r);return"object"==typeof o&&n.size()>0&&(n.empty(),"ASC"===e.sortMethod?i=i.sort(e.Comparator):"DESC"===e.sortMethod&&(i=i.sort(e.Comparator).reverse()),t.each(i,function(e,r){n.append(t("<option />").attr({value:r}).text(r))})),e},e.FillSelect=function(n,r,i){var o=r?"()"===r.substring(r.length-2,r.length):!1,a=i?"()"===i.substring(i.length-2,i.length):!1,s=e.Get(n);return t.each(e.Find('select[name*="'+n+'"]'),function(n,u){u=t(u),u.empty(),"ASC"===e.sortMethod?s=s.sort(e.Comparator):"DESC"===e.sortMethod&&(s=s.sort(e.Comparator).reverse()),t.each(s,function(e,n){var s=r?o?n[r.substring(0,r.length-2)]():n[r]:n,c=i?a?n[i.substring(0,i.length-2)]():n[i]:n;u.append(t("<option />").attr({value:c}).text(s))})}),e},e.RunEvent=function(n){var r=n.target.name,i=n.target.value,o=n.type;if(void 0===o&&(o=n),void 0!==n){if(t.trim(r).length>0&&void 0!==e.settings[o]&&null!==e.settings[o]){e.settings.eventUsed=o;var a=e[r],s=a;if(-1!==n.target.type.indexOf("select")){var u=n.target.selectedIndex,c=n.target.options[u];c&&(i=c.value,s=a[u])}if(e.Has(r)&&"object"==typeof e.Get(r)){var d=r.substring(r.length-1,r.length).toLowerCase();d="s"===d?r.substring(0,r.length-1):r,d="selected"+d.toUpperCaseFirst(),e.Set(d,i)}e.settings[o](n,r,i,e,a,s)}return e}},e.Start=function(t,n){var r;return void 0!==e.settings.controller&&(r=e.settings.controller[t]),void 0===r&&(r=e[t]),void 0!==r&&null!==r?r(n,e):console.log("Missing "+t+"() method!"),e},e.toArray=function(){return t.makeArray(e)},e.GetViewId=function(){return e.settings.viewId},e.Find=function(n){return t(e.GetViewId()+" "+n)},e.AddEvents=function(){return t(a+" :input").focus(function(t){e.RunEvent(t)}).blur(function(t){e.RunEvent(t)}).change(function(t){e.SetModelFromView(),e.RunEvent(t)}).select(function(t){e.RunEvent(t)}).submit(function(t){e.RunEvent(t)}).click(function(t){e.SetModelFromView(),e.RunEvent(t)}).keyup(function(t){void 0===e.settings.keyup&&e.SetModelFromView(),e.RunEvent(t)}).keypress(function(t){e.RunEvent(t)}).keydown(function(t){e.RunEvent(t)}),e},e.SetViewFromModel(),e.SetModelFromView(),e.settings.isMirror&&t.each(e.GetModelData(),function(t){e.AddGetSet(t)}),e.settings.autoSaveInterval>0&&(e.settings.eventUsed='"autoSave"',setInterval(function(){e.Save()},e.settings.autoSaveInterval)),e.AddEvents(),n=t.extend({},!0,n,{originalModelValues:e.GetModelData()}),n={settings:n},t.extend(e,n);var g=e.init;return void 0!==g&&null!==g&&g(e),e}})}),function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(t.jQuery)}(this,function(t){t.fn.extend({getSetHtml:function(t){return void 0!==t?this.setValues(t):this.getValues()},getInputElements:function(t){return t.find("input,select,textarea").not(".excludeFromModel")},getElementKey:function(e){var n=t(e).attr("datafld");return void 0===n&&(n=t(e).attr("id")),void 0===n&&(n=t(e).attr("data-bind")),n},getBindableElements:function(t){return t.find("*[data-bind], *[datafld]").not(".excludeFromModel")},setValues:function(e){var n=this;n.getBindableElements(this).each(function(){var r=n.getElementKey(this);if(void 0!==r){var i=e[r];t(this).html(i)}}),n.getInputElements(this).each(function(){var n,r=e[t(this).attr("name")];if(void 0!==r)if(n=t(this),n.is("select")){if(!n.val()){var i=n;i.empty(),t.each(r.sort(),function(e,n){var r=n,o=n;"object"==typeof n&&t.each(n,function(t,e){var i="function"==typeof e;r=i?n.toString():t,o=i?n.toString():e}),i.append(t("<option />").attr({value:o}).text(r))})}}else n.is(":radio")?n.val()===r&&n.attr("checked",!0):n.is(":checkbox")?(r?n.attr("checked",!0):(r=t.isArray(r)?r:[r],t.inArray(n.val(),r)>-1&&n.attr("checked",!0)),n.val(r)):n.val(r)})},getValues:function(){var e={},n={},r=this;return r.getInputElements(this).each(function(){var e=t(this),r=e.attr("type"),i=e.attr("name"),o=e.val();if("submit"!==r&&i)if(e.hasClass("isNumber")&&(o=parseInt(o,null)),e.is("select")){var a=MVC.List([]);t.each(e.find("option"),function(e,n){var r=t(n).val();r=isNaN(r)?r:parseInt(r),a.Add(r)}),selectedValues=a.Sort(),o=a,n[i]=o}else e.is(":checkbox")?(o=!1,e.attr("checked")|e.prop("checked")&&(o=!0),n[i]=o):e.is(":radio")?e.attr("checked")|e.prop("checked")&&(n[i]=o):n[i]=o}),r.getBindableElements(this).each(function(){var n=t(this),i=n.text();if(void 0!==i){var o=r.getElementKey(this);if(void 0===o)return;n.hasClass("isNumber")&&(i=parseInt(i,null)),e[o]=i}}),t.extend(e,n),e}})}),String.prototype.format=String.prototype.f=function(){for(var t=this,e=arguments.length;e--;)t=t.replace(new RegExp("\\{"+e+"\\}","gm"),arguments[e]);return t},String.prototype.toUpperCaseFirst=function(){return this.charAt(0).toUpperCase()+this.slice(1)};