<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Example 8</title>
    <!--IE fixes -->
    <script type="text/javascript" src="../lib/json2.js"></script>
    <script type="text/javascript"> if (!window['console']) console = {log: function() {}}; </script>
    <!--//end IE fixes -->
    <!--<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>-->
    <script type="text/javascript" src="../lib/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../simple.mvc.js"></script>
    <!--optional:-->
    <script type="text/javascript" src="../../simplemvc-showcase/lib/bootstrap/js/bootstrap.min.js"></script>
    <link type="text/css" rel="stylesheet" href="../../simplemvc-showcase/lib/bootstrap/css/bootstrap.css" />
    <!--//end optional-->
  </head>
  <body style="background-color:#fcfcfc; border:1px solid #ccc; padding: 5px;">
    
    <!-- View: template -->
    <div id="template" style="display: none;" class="well">
      <h3>View ID: <span style="font-weight: bold;" name="id" datasrc="#template"> view id will get placed here </span></h3>
      <br />
      Name: <input type="text" name="name" id="name" value="" />
      <br />
      Address: <input type="text" name="address" id="address" value="" />
      <br />
      Change the value on blur event?
      <input type="radio" name="enableBlur" value="yes" checked="checked" /> Yes
      <input type="radio" name="enableBlur" value="no" /> No
      <br />
      <h3>Data entered:</h3>
      <p>      
        Name: <span style="font-weight: bold;" datasrc="#testArea" name="name" class="excludeFromModel"> </span>
        <br /> 
        Address: <span style="font-weight: bold;" datasrc="#testArea" name="address" class="excludeFromModel"> </span>
      </p>
      <br />
      <hr />
      
    </div><!-- //end of template view -->
    
    <div class="page-header">
      <h1>
        Cloning templates
        <small>
          Amount of clones: <span id="cloneCount"> </span>
        </small>
      </h1>
    </div>
    <p>
      <button id="createClone" class="btn btn-primary">Create clone</button>
      <br />
      <br />
      <h2>Known issues</h2>
      <ol>
        <li>When cloning, then radio checked attribute is not copied</li>
        <li>If a single or group of radio form element/s doesn't have the 'checked' attribute, then it's not added to the model.</li>
      </ol>
    </p>
    <br />
    <br />
    <div class="row-fluid">
      <div class="span3">
        <h2>Copies of the template</h2>
        <br />
        <div id="copies">
          <!-- clones will be appended here  -->
        </div>
      </div>
      <div class="span9">
        <div id="debug"> </div>
      </div>
    </div>
    
    <script>
    var clones = [];
        
    $(function() {
      createClone('John Doe', 'A grave somewhere');
      
      $('#createClone').click(function() {
        createClone('', '');
      });
      
      moveDown('#debug',60);
    });
    
    function createClone(_name, _address) {
      var o = MVC.ModelView("#template", {
        name : _name, 
        address : _address 
      }, {
        focus : function(e, n, v) {
          printDebugInfo(o);
        },
        blur : function(e, n, v) {
          if(o['enableBlur'] === 'yes') {
            o.Set(n, 'The programmer is messing with you');
          }
          printDebugInfo(o);
        },
        keyup : function(e, n, v) {
          printDebugInfo(o);
        },
        clone : {
          id : '#'+Date.now(),
          target : '#copies',
          withDataAndEvents : true
        }
      });
      //o['id'] = o['settings']['viewId']; o.SetViewFromModel();
      o.Set('id', o['settings']['viewId']);
      clones.push(o);
      printDebugInfo(o);
    }
    
    function printDebugInfo(o) {
      o.SetModelFromView();
      DebugObj('#debug', { o1 : { object : o, readDom : true } });
      $('#cloneCount').text(clones.length);
    }
    </script>
    <script src="debug.js"></script>
  </body>
</html>